package com.rwn.rwnstudy.activities;import android.content.DialogInterface;import android.content.Intent;import androidx.annotation.NonNull;import androidx.appcompat.app.AlertDialog;import androidx.appcompat.app.AppCompatActivity;import android.os.Bundle;import androidx.recyclerview.widget.LinearLayoutManager;import androidx.recyclerview.widget.RecyclerView;import android.view.LayoutInflater;import android.view.View;import android.view.ViewGroup;import android.widget.TextView;import com.firebase.ui.database.FirebaseRecyclerAdapter;import com.firebase.ui.database.FirebaseRecyclerOptions;import com.google.firebase.auth.FirebaseAuth;import com.google.firebase.database.DataSnapshot;import com.google.firebase.database.DatabaseError;import com.google.firebase.database.DatabaseReference;import com.google.firebase.database.FirebaseDatabase;import com.google.firebase.database.ValueEventListener;import com.rwn.rwnstudy.R;import com.squareup.picasso.Picasso;import de.hdodenhof.circleimageview.CircleImageView;public class FriendsActivity extends AppCompatActivity {    RecyclerView recyclerViewFriendList;    DatabaseReference databaseReferenceFriendRef, databaseReferenceUserRef;    FirebaseAuth mAuth;    String CURRENT_USER;    @Override    protected void onCreate(Bundle savedInstanceState) {        super.onCreate(savedInstanceState);        setContentView(R.layout.activity_friends);        viewIntializing();        displayAllFriends();    }    private void viewIntializing() {        recyclerViewFriendList = findViewById(R.id.recyclerView_FriendsList);        recyclerViewFriendList.setHasFixedSize(true);        LinearLayoutManager linearLayoutManager = new LinearLayoutManager(FriendsActivity.this);        linearLayoutManager.setReverseLayout(true);        linearLayoutManager.setStackFromEnd(true);        recyclerViewFriendList.setLayoutManager(linearLayoutManager);        mAuth = FirebaseAuth.getInstance();        CURRENT_USER = mAuth.getCurrentUser().getUid();        databaseReferenceFriendRef = FirebaseDatabase.getInstance().getReference().child("DocumentAccessAuthority").child(CURRENT_USER);        databaseReferenceUserRef = FirebaseDatabase.getInstance().getReference().child("Users");    }    private void displayAllFriends() {        FirebaseRecyclerOptions<Boolean> options =                new FirebaseRecyclerOptions.Builder <Boolean>()                        .setQuery(databaseReferenceFriendRef, Boolean.class)                        .build();        FirebaseRecyclerAdapter<Boolean, FriendsViewHolder> firebaseRecyclerAdapter =                new FirebaseRecyclerAdapter <Boolean,FriendsViewHolder>(options) {                    @Override                    protected void onBindViewHolder(@NonNull final FriendsViewHolder holder, int position, @NonNull final Boolean model) {                        final String USER_IDs=getRef(position).getKey();                        databaseReferenceUserRef.child(USER_IDs)                                .addValueEventListener(new ValueEventListener() {                                    @Override                                    public void onDataChange(DataSnapshot dataSnapshot) {                                        if(dataSnapshot.exists()){                                            final String userName= dataSnapshot.child("name").getValue().toString();                                            if(dataSnapshot.hasChild("profileImage")) {                                                final String profileImage = dataSnapshot.child("profileImage").getValue().toString();                                                Picasso.get().load(profileImage).resize(100, 100).noFade().into(holder.ProfileImage);                                            }                                            holder.Fullname.setText(userName);                                            holder.Date.setText("Tab to message");                                            holder.itemView.setOnClickListener(new View.OnClickListener() {                                                @Override                                                public void onClick(View v) {                                                    CharSequence options[]= new CharSequence[]{                                                          //  userName + "'s profiles ",                                                            "Send Message"                                                    };                                                    AlertDialog.Builder builder= new AlertDialog.Builder(FriendsActivity.this)                                                            .setTitle("Select Option");                                                    builder.setItems(options,   new DialogInterface.OnClickListener() {                                                        @Override                                                        public void onClick(DialogInterface dialog, int which) {//                                                            if(which == 0){//////                                                                Intent profileInten= new Intent(FriendsActivity.this,PersonProfileActivity.class);////                                                                profileInten.putExtra("visit_user_id",USER_IDs);////                                                                startActivity(profileInten);////                                                            }                                                            if(which == 0){                                                                Intent chatIntent= new Intent(FriendsActivity.this,ChatActivity.class);                                                                chatIntent.putExtra("visit_user_id",USER_IDs);                                                                chatIntent.putExtra("username",userName);                                                                startActivity(chatIntent);                                                            }                                                        }                                                    });                                                    builder.show();                                                }                                            });                                        }                                    }                                    @Override                                    public void onCancelled(DatabaseError databaseError) {                                    }                                });                    }                    @NonNull                    @Override                    public FriendsViewHolder onCreateViewHolder(@NonNull ViewGroup parent, int viewType) {                        View view = LayoutInflater.from(parent.getContext())                                .inflate(R.layout.all_user_display_from_search, parent, false);                        FriendsViewHolder friendsViewHolder = new FriendsViewHolder(view);                        return friendsViewHolder;                    }                };        recyclerViewFriendList.setAdapter(firebaseRecyclerAdapter);        firebaseRecyclerAdapter.startListening();    }    public static class FriendsViewHolder extends RecyclerView.ViewHolder {        public TextView Fullname, Date;        public CircleImageView ProfileImage;        public FriendsViewHolder(View itemView) {            super(itemView);            Fullname = itemView.findViewById(R.id.textView_search_alluserProfile_Fullname);            ProfileImage = itemView.findViewById(R.id.circularView_search_profile);            Date = itemView.findViewById(R.id.textView_search_alluserProfile_status);        }    }}